<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ISS Live 3D Tracker Pro</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Arial, sans-serif; background: #000; overflow: hidden; color: white; }
        #info { position: fixed; top: 10px; left: 10px; background: rgba(0,0,0,0.4); padding: 6px; border-radius: 10px; z-index: 10; font-size: 11px; backdrop-filter: blur(6px); border: 1px solid rgba(0,255,0,0.25); width: auto; max-width: 340px; display: none; align-items: center; gap: 6px; pointer-events: none; }
        #info h2 { margin: 0; color: #00ff00; font-size: 14px; display: flex; align-items: center; gap: 6px; }
        #toggleCompact, #toggleHide { margin-left: 6px; color: #0f0; background: rgba(0,255,0,0.12); border: 1px solid rgba(0,255,0,0.3); border-radius: 999px; padding: 2px 6px; font-size: 10px; pointer-events: auto; }
        #chips { display: flex; align-items: center; gap: 4px; flex-wrap: wrap; margin-left: 8px; }
        .chip { display: inline-flex; align-items: center; gap: 3px; padding: 3px 6px; border: 1px solid rgba(0,255,0,0.25); border-radius: 999px; background: rgba(255,255,255,0.04); color: #fff; }
        .chip .label { color: #00ff00; }
        #details { display: grid; grid-template-columns: repeat(2, minmax(160px, auto)); gap: 8px; margin-top: 8px; max-height: 40vh; overflow: auto; }
        canvas { position: fixed !important; top: 0; left: 0; width: 100vw !important; height: 100vh !important; z-index: 0; }
        .section { margin: 0; padding: 6px 8px; background: rgba(255,255,255,0.04); border-radius: 8px; border-left: 2px solid #00ff00; }
        .section-title { color: #00ff00; font-weight: 600; margin-bottom: 6px; font-size: 12px; }
        .data-row { margin: 4px 0; display: flex; justify-content: space-between; }
        .label { color: #888; }
        .value { color: #fff; font-weight: 600; }
        .astronauts { margin-top: 6px; padding: 6px; background: rgba(255,255,0,0.1); border-radius: 4px; font-size: 11px; }
        .pass-time { background: rgba(0,255,0,0.1); padding: 6px; margin: 4px 0; border-radius: 4px; font-size: 11px; }
        .weather { display: flex; align-items: center; gap: 8px; padding: 6px; background: rgba(100,150,255,0.1); border-radius: 4px; }
        .hidden { display: none; }
        @media (max-width: 430px) { .section { min-width: 140px; } #info { gap: 6px; } #info h2 { font-size: 15px; } }
        #loading { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: white; font-size: 20px; z-index: 200; background: rgba(0,0,0,0.8); padding: 20px 40px; border-radius: 10px; }
        .controls { position: absolute; bottom: 20px; left: 20px; background: rgba(0,0,0,0.85); padding: 15px; border-radius: 10px; font-size: 12px; }
        .control-item { margin: 5px 0; color: #888; }
    </style>
</head>
<body>
    <div id="loading">üõ∞Ô∏è Loading ISS data...</div>
    <div id="info" class="compact">
        <h2>üõ∞Ô∏è ISS Tracker Pro</h2>
        <button id="toggleCompact">Details</button>
        <button id="toggleHide">Hide</button>
        <div id="chips">
            <span class="chip" id="chipLat"><span class="label">Lat</span> <span class="value">--</span></span>
            <span class="chip" id="chipLon"><span class="label">Lon</span> <span class="value">--</span></span>
            <span class="chip" id="chipUpdate"><span class="label">Time</span> <span class="value">--:--</span></span>
            <span class="chip" id="chipCrew"><span class="label">Crew</span> <span class="value">--</span></span>
            <span class="chip" id="chipTemp"><span class="label">Temp</span> <span class="value">--¬∞C</span></span>
        </div>
        <div id="details" class="hidden">
        <div class="section">
            <div class="section-title">üìç ISS Position</div>
            <div class="data-row"><span class="label">Latitude:</span><span class="value" id="lat">--</span></div>
            <div class="data-row"><span class="label">Longitude:</span><span class="value" id="lon">--</span></div>
            <div class="data-row"><span class="label">Speed:</span><span class="value">~27,600 km/s</span></div>
            <div class="data-row"><span class="label">Altitude:</span><span class="value">~408 km</span></div>
            <div class="data-row"><span class="label">Updated:</span><span class="value" id="update">--</span></div>
        </div>
        <div class="section">
            <div class="section-title">üë®‚ÄçüöÄ Astronauts</div>
            <div id="astronauts">Loading...</div>
        </div>
        <div class="section">
            <div class="section-title">üåç From Your Location</div>
            <div class="data-row"><span class="label">Location:</span><span class="value" id="userLocation">--</span></div>
            <div id="passTimes">Calculating pass times...</div>
        </div>
        <div class="section">
            <div class="section-title">üå§Ô∏è Weather</div>
            <div id="weather">Loading...</div>
        </div>
        </div>
    </div>
    <div id="accordion" style="position:fixed; top:10px; left:10px; right:10px; display:flex; gap:8px; align-items:flex-start; justify-content:flex-start; z-index: 10; pointer-events:auto;">
        <div class="accordion-item" style="flex:1; min-width: 30%;">
            <div class="accordion-header" id="accPos" style="display:flex; align-items:center; gap:6px; padding:8px 10px; border-radius:8px; border:1px solid rgba(0,255,0,0.35); background:rgba(0,0,0,0.5); color:#00ff00; font-weight:700; cursor:pointer; font-size:13px;">
                <span>üìç ISS Position</span>
                <div id="accPosControls" style="display:none; margin-top:6px; padding:8px 10px; border-radius:8px; border:1px solid rgba(0,255,0,0.25); background:rgba(0,0,0,0.35); color:#fff; display:none;">
                    <div style="display:flex; gap:8px;">
                        <button id="btnToggleISS" style="color:#0f0; background:rgba(0,255,0,0.12); border:1px solid rgba(0,255,0,0.3); border-radius:999px; padding:4px 8px; font-size:12px;">Hide Craft</button>
                    <button id="btnToggleOrbit" style="color:#0f0; background:rgba(0,255,0,0.12); border:1px solid rgba(0,255,0,0.3); border-radius:999px; padding:4px 8px; font-size:12px;">Show Orbit</button>
                    </div>
                </div>
            </div>
            <div class="accordion-content" id="accPosContent" style="display:none; margin-top:6px; padding:8px 10px; border-radius:8px; border:1px solid rgba(0,255,0,0.25); background:rgba(0,0,0,0.45); color:#fff;">
                <div class="data-row"><span class="label">Latitude:</span><span class="value" id="accLat">--</span></div>
                <div class="data-row"><span class="label">Longitude:</span><span class="value" id="accLon">--</span></div>
                <div class="data-row"><span class="label">Updated:</span><span class="value" id="accUpdate">--</span></div>
            </div>
        </div>
        <div class="accordion-item" style="flex:1; min-width: 30%;">
            <div class="accordion-header" id="accCrew" style="display:flex; align-items:center; gap:6px; padding:8px 10px; border-radius:8px; border:1px solid rgba(0,255,0,0.35); background:rgba(0,0,0,0.5); color:#00ff00; font-weight:700; cursor:pointer; font-size:13px;">
                <span>üë®‚ÄçüöÄ Astronauts</span>
            </div>
            <div class="accordion-content" id="accCrewContent" style="display:none; margin-top:6px; padding:8px 10px; border-radius:8px; border:1px solid rgba(0,255,0,0.25); background:rgba(0,0,0,0.45); color:#fff; max-height:35vh; overflow:auto;">
                <div id="accCrewList">Loading...</div>
            </div>
        </div>
        <div class="accordion-item" style="flex:1; min-width: 30%;">
            <div class="accordion-header" id="accWeather" style="display:flex; align-items:center; gap:6px; padding:8px 10px; border-radius:8px; border:1px solid rgba(0,255,0,0.35); background:rgba(0,0,0,0.5); color:#00ff00; font-weight:700; cursor:pointer; font-size:13px;">
                <span>üå§Ô∏è Weather</span>
            </div>
            <div class="accordion-content" id="accWeatherContent" style="display:none; margin-top:6px; padding:8px 10px; border-radius:8px; border:1px solid rgba(0,255,0,0.25); background:rgba(0,0,0,0.45); color:#fff;">
                <div id="accWeatherBox">Loading...</div>
                <div class="data-row"><span class="label">Location:</span><span class="value" id="accUserLocation">--</span></div>
                <div id="accPassTimes" style="margin-top:6px;"></div>
            </div>
        </div>
    </div>
    <div class="controls">
        <div class="control-item">üñ±Ô∏è Mouse: Rotate Earth</div>
        <div class="control-item">üñ±Ô∏è Wheel: Zoom</div>
        <div class="control-item">üì± Touch: Rotate</div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        let scene, camera, renderer, earth, issModel, issMarker, issSprite, orbitLine, orbitPoints, orbitRing, sunLight;
        let issPositions = [];
        const maxOrbitPoints = 100;
        const EARTH_RADIUS = 5;
        const RING_RADIUS = EARTH_RADIUS + 0.12;
        let userLat = 37.0;
        let userLon = 35.3;
        let isDragging = false;
        let previousMousePosition = { x: 0, y: 0 };
        let compactMode = true;
        let hidePanel = false;
        let showISSModel = true;
        let showOrbit = true;

        function init() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setPixelRatio(Math.min(2, window.devicePixelRatio || 1));
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);
            const ambientLight = new THREE.AmbientLight(0x333333, 1);
            scene.add(ambientLight);
            sunLight = new THREE.DirectionalLight(0xffffff, 2);
            scene.add(sunLight);
            const earthGeometry = new THREE.SphereGeometry(EARTH_RADIUS, 64, 64);
            const textureLoader = new THREE.TextureLoader();
            const earthTexture = textureLoader.load('https://unpkg.com/three-globe/example/img/earth-blue-marble.jpg');
            const bumpTexture = textureLoader.load('https://unpkg.com/three-globe/example/img/earth-topology.png');
            const nightTexture = textureLoader.load('https://unpkg.com/three-globe/example/img/earth-night.jpg');
            const earthMaterial = new THREE.MeshPhongMaterial({
                map: earthTexture,
                bumpMap: bumpTexture,
                bumpScale: 0.05,
                emissiveMap: nightTexture,
                emissive: 0xffffff,
                emissiveIntensity: 0.8,
                shininess: 10,
                specular: 0x333333
            });
            earth = new THREE.Mesh(earthGeometry, earthMaterial);
            scene.add(earth);
            const starsGeometry = new THREE.BufferGeometry();
            const starsMaterial = new THREE.PointsMaterial({ color: 0xffffff, size: 0.1 });
            const starsVertices = [];
            for (let i = 0; i < 10000; i++) {
                const x = (Math.random() - 0.5) * 2000;
                const y = (Math.random() - 0.5) * 2000;
                const z = (Math.random() - 0.5) * 2000;
                starsVertices.push(x, y, z);
            }
            starsGeometry.setAttribute('position', new THREE.Float32BufferAttribute(starsVertices, 3));
            const stars = new THREE.Points(starsGeometry, starsMaterial);
            scene.add(stars);
            issModel = new THREE.Group();
            const bodyGeo = new THREE.CylinderGeometry(0.08, 0.08, 0.4, 8);
            const bodyMat = new THREE.MeshPhongMaterial({ color: 0xcccccc });
            const body = new THREE.Mesh(bodyGeo, bodyMat);
            body.rotation.z = Math.PI / 2;
            issModel.add(body);
            const panelGeo = new THREE.BoxGeometry(0.6, 0.01, 0.3);
            const panelMat = new THREE.MeshPhongMaterial({ color: 0x1a3d7a });
            const panel1 = new THREE.Mesh(panelGeo, panelMat);
            panel1.position.set(-0.4, 0, 0);
            issModel.add(panel1);
            const panel2 = new THREE.Mesh(panelGeo, panelMat);
            panel2.position.set(0.4, 0, 0);
            issModel.add(panel2);
            const antennaGeo = new THREE.CylinderGeometry(0.01, 0.01, 0.2, 8);
            const antennaMat = new THREE.MeshPhongMaterial({ color: 0xffaa00 });
            const antenna = new THREE.Mesh(antennaGeo, antennaMat);
            antenna.position.set(0, 0.2, 0);
            issModel.add(antenna);
            scene.add(issModel);
            issMarker = new THREE.Mesh(new THREE.SphereGeometry(0.18, 16, 16), new THREE.MeshBasicMaterial({ color: 0xffff00, depthTest: false }));
            scene.add(issMarker);
            const spriteUrl = 'https://upload.wikimedia.org/wikipedia/commons/thumb/d/d0/International_Space_Station_after_undocking_of_STS-132.jpg/128px-International_Space_Station_after_undocking_of_STS-132.jpg';
            const spriteTex = new THREE.TextureLoader().load(spriteUrl);
            const spriteMat = new THREE.SpriteMaterial({ map: spriteTex, transparent: true, depthTest: false });
            issSprite = new THREE.Sprite(spriteMat);
            issSprite.scale.set(0.9, 0.6, 1);
            scene.add(issSprite);
            const orbitGeometry = new THREE.BufferGeometry();
            const orbitMaterial = new THREE.LineBasicMaterial({ color: 0x00ff00, transparent: true, opacity: 0.95, depthTest: false });
            orbitLine = new THREE.Line(orbitGeometry, orbitMaterial);
            scene.add(orbitLine);
            const orbitPointsGeometry = new THREE.BufferGeometry();
            const orbitPointsMaterial = new THREE.PointsMaterial({ color: 0x00ff00, size: 0.22, sizeAttenuation: false, transparent: true, opacity: 0.95, depthTest: false });
            orbitPoints = new THREE.Points(orbitPointsGeometry, orbitPointsMaterial);
            scene.add(orbitPoints);
            orbitRing = new THREE.LineLoop(new THREE.BufferGeometry(), new THREE.LineBasicMaterial({ color: 0xff0000, transparent: true, opacity: 0.95, depthTest: false }));
            scene.add(orbitRing);
            issModel.scale.set(2, 2, 2);
            issModel.visible = false;
            issMarker.visible = false;
            issSprite.visible = true;
            orbitLine.visible = false;
            orbitPoints.visible = false;
            orbitRing.visible = showOrbit;
            camera.position.z = 15;
            setupControls();
            window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            });
            getUserLocation();
            updateSunPosition();
            updateISSPosition();
            getAstronauts();
            setInterval(updateISSPosition, 5000);
            setInterval(updateSunPosition, 60000);
            animate();
        }

        function applyLayout() {
            const info = document.getElementById('info');
            info.style.display = 'none';
        }

        function setupControls() {
            renderer.domElement.addEventListener('mousedown', (e) => {
                isDragging = true;
                previousMousePosition = { x: e.clientX, y: e.clientY };
            });
            renderer.domElement.addEventListener('mousemove', (e) => {
                if (isDragging) {
                    const deltaX = e.clientX - previousMousePosition.x;
                    const deltaY = e.clientY - previousMousePosition.y;
                    earth.rotation.y += deltaX * 0.005;
                    earth.rotation.x += deltaY * 0.005;
                    previousMousePosition = { x: e.clientX, y: e.clientY };
                }
            });
            renderer.domElement.addEventListener('mouseup', () => { isDragging = false; });
            let lastTouchX = 0, lastTouchY = 0;
            renderer.domElement.addEventListener('touchstart', (e) => {
                if (e.touches.length === 1) {
                    lastTouchX = e.touches[0].clientX;
                    lastTouchY = e.touches[0].clientY;
                }
            });
            renderer.domElement.addEventListener('touchmove', (e) => {
                if (e.touches.length === 1) {
                    const deltaX = e.touches[0].clientX - lastTouchX;
                    const deltaY = e.touches[0].clientY - lastTouchY;
                    earth.rotation.y += deltaX * 0.005;
                    earth.rotation.x += deltaY * 0.005;
                    lastTouchX = e.touches[0].clientX;
                    lastTouchY = e.touches[0].clientY;
                }
            });
            renderer.domElement.addEventListener('wheel', (e) => {
                e.preventDefault();
                camera.position.z += e.deltaY * 0.01;
                camera.position.z = Math.max(8, Math.min(30, camera.position.z));
            });
        }

        function getUserLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        userLat = position.coords.latitude;
                        userLon = position.coords.longitude;
                        document.getElementById('userLocation').textContent = `${userLat.toFixed(2)}¬∞, ${userLon.toFixed(2)}¬∞`;
                        const aul = document.getElementById('accUserLocation'); if (aul) aul.textContent = `${userLat.toFixed(2)}¬∞, ${userLon.toFixed(2)}¬∞`;
                        updateSunPosition();
                        getWeather();
                        getISSPassTimes();
                    },
                    () => {
                        document.getElementById('userLocation').textContent = 'Adana, TR';
                        getWeather();
                        getISSPassTimes();
                    }
                );
            }
        }

        function updateSunPosition() {
            const now = new Date();
            const hours = now.getUTCHours();
            const minutes = now.getUTCMinutes();
            const sunLongitude = ((hours + minutes / 60) * 15) - 180;
            const dayOfYear = Math.floor((now - new Date(now.getFullYear(), 0, 0)) / 86400000);
            const sunLatitude = 23.44 * Math.sin((2 * Math.PI / 365) * (dayOfYear - 81));
            const sunPos = latLonToVector3(sunLatitude, sunLongitude, 50);
            sunLight.position.copy(sunPos);
        }

        function latLonToVector3(lat, lon, radius) {
            const phi = (90 - lat) * Math.PI / 180;
            const theta = (lon + 180) * Math.PI / 180;
            return new THREE.Vector3(
                -radius * Math.sin(phi) * Math.cos(theta),
                radius * Math.cos(phi),
                radius * Math.sin(phi) * Math.sin(theta)
            );
        }

        async function updateISSPosition() {
            try {
                const response = await fetch('http://api.open-notify.org/iss-now.json');
                const data = await response.json();
                const lat = parseFloat(data.iss_position.latitude);
                const lon = parseFloat(data.iss_position.longitude);
                const issPos = latLonToVector3(lat, lon, 6.5);
                const issPosOnRing = issPos.clone().normalize().multiplyScalar(RING_RADIUS);
                issModel.position.copy(issPos);
                issMarker.position.copy(issPosOnRing);
                issSprite.position.copy(issPosOnRing);
                issModel.lookAt(0, 0, 0);
                issModel.rotateX(Math.PI / 2);
                issPositions.push(issPos.clone());
                if (issPositions.length > maxOrbitPoints) { issPositions.shift(); }
                const newGeom = new THREE.BufferGeometry().setFromPoints(issPositions);
                if (orbitLine.geometry) orbitLine.geometry.dispose();
                orbitLine.geometry = newGeom;
                const pts = new Float32Array(issPositions.length * 3);
                issPositions.forEach((pos, i) => { pts[i*3] = pos.x; pts[i*3+1] = pos.y; pts[i*3+2] = pos.z; });
                if (orbitPoints.geometry) orbitPoints.geometry.dispose();
                const og = new THREE.BufferGeometry();
                og.setAttribute('position', new THREE.BufferAttribute(pts, 3));
                orbitPoints.geometry = og;
                updateOrbitRing();
            document.getElementById('lat').textContent = lat.toFixed(4) + '¬∞';
            document.getElementById('lon').textContent = lon.toFixed(4) + '¬∞';
            document.getElementById('update').textContent = new Date().toLocaleTimeString('tr-TR');
            document.getElementById('loading').style.display = 'none';
            const cl = document.querySelector('#chipLat .value');
            const cn = document.querySelector('#chipLon .value');
            const cu = document.querySelector('#chipUpdate .value');
            if (cl) cl.textContent = lat.toFixed(2) + '¬∞';
            if (cn) cn.textContent = lon.toFixed(2) + '¬∞';
            if (cu) cu.textContent = new Date().toLocaleTimeString('tr-TR');
            const accLat = document.getElementById('accLat');
            const accLon = document.getElementById('accLon');
            const accUpdate = document.getElementById('accUpdate');
            if (accLat) accLat.textContent = lat.toFixed(4) + '¬∞';
            if (accLon) accLon.textContent = lon.toFixed(4) + '¬∞';
            if (accUpdate) accUpdate.textContent = new Date().toLocaleTimeString('tr-TR');
        } catch (error) {}
        }

        async function getAstronauts() {
            try {
                const response = await fetch('http://api.open-notify.org/astros.json');
                const data = await response.json();
                const issAstronauts = data.people.filter(p => p.craft === 'ISS');
                let html = `<div style="color: #ffff00; font-weight: bold;">Toplam: ${issAstronauts.length} ki≈üi</div>`;
                html += '<div class="astronauts">';
                issAstronauts.forEach(a => { html += `<div>üë®‚ÄçüöÄ ${a.name}</div>`; });
                html += '</div>';
                document.getElementById('astronauts').innerHTML = html;
                const cc = document.querySelector('#chipCrew .value');
                if (cc) cc.textContent = issAstronauts.length.toString();
                const acl = document.getElementById('accCrewList');
                if (acl) acl.innerHTML = html;
            } catch (error) { document.getElementById('astronauts').innerHTML = 'Y√ºklenemedi'; }
        }

        async function getISSPassTimes() {
            try {
                const response = await fetch(`http://api.open-notify.org/iss-pass.json?lat=${userLat}&lon=${userLon}&n=5`);
                const data = await response.json();
                let html = '';
                data.response.forEach((pass, i) => {
                    const date = new Date(pass.risetime * 1000);
                    const duration = Math.floor(pass.duration / 60);
                    html += `<div class="pass-time"><strong>${i + 1}.</strong> ${date.toLocaleDateString('tr-TR')} ${date.toLocaleTimeString('tr-TR')} (${duration} dk)</div>`;
                });
                document.getElementById('passTimes').innerHTML = html || 'Ge√ßi≈ü bulunamadƒ±';
                const apt = document.getElementById('accPassTimes'); if (apt) apt.innerHTML = html || 'Ge√ßi≈ü bulunamadƒ±';
            } catch (error) { document.getElementById('passTimes').innerHTML = 'Hesaplanamadƒ±'; }
        }

        async function getWeather() {
            try {
                const response = await fetch(`https://wttr.in/${userLat},${userLon}?format=j1`);
                const data = await response.json();
                const current = data.current_condition[0];
                const html = `<div class="weather"><div style="font-size: 32px;">${getWeatherEmoji(current.weatherCode)}</div><div><div>${current.temp_C}¬∞C</div><div style="font-size: 11px; color: #888;">${current.weatherDesc[0].value}</div></div></div>`;
                document.getElementById('weather').innerHTML = html;
                const ct = document.querySelector('#chipTemp .value');
                if (ct) ct.textContent = `${current.temp_C}¬∞C`;
                const awb = document.getElementById('accWeatherBox');
                if (awb) awb.innerHTML = html;
            } catch (error) { document.getElementById('weather').innerHTML = 'Y√ºklenemedi'; }
        }

        function getWeatherEmoji(code) {
            const weatherCodes = { '113': '‚òÄÔ∏è','116': '‚õÖ','119': '‚òÅÔ∏è','122': '‚òÅÔ∏è','143': 'üå´Ô∏è','176': 'üå¶Ô∏è','179': 'üå®Ô∏è','182': 'üå®Ô∏è','185': 'üå®Ô∏è','200': '‚õàÔ∏è','227': 'üå®Ô∏è','230': '‚ùÑÔ∏è','248': 'üå´Ô∏è','260': 'üå´Ô∏è','263': 'üåßÔ∏è','266': 'üåßÔ∏è','281': 'üåßÔ∏è','284': 'üåßÔ∏è','293': 'üåßÔ∏è','296': 'üåßÔ∏è','299': 'üåßÔ∏è','302': 'üåßÔ∏è','305': 'üåßÔ∏è','308': 'üåßÔ∏è','311': 'üåßÔ∏è','314': 'üåßÔ∏è','317': 'üåßÔ∏è','320': 'üå®Ô∏è','323': 'üå®Ô∏è','326': 'üå®Ô∏è','329': 'üå®Ô∏è','332': 'üå®Ô∏è','335': 'üå®Ô∏è','338': 'üå®Ô∏è','350': 'üå®Ô∏è','353': 'üåßÔ∏è','356': 'üåßÔ∏è','359': 'üåßÔ∏è','362': 'üå®Ô∏è','365': 'üå®Ô∏è','368': 'üå®Ô∏è','371': 'üå®Ô∏è','374': 'üå®Ô∏è','377': 'üå®Ô∏è','386': '‚õàÔ∏è','389': '‚õàÔ∏è','392': '‚õàÔ∏è','395': '‚õàÔ∏è' };
            return weatherCodes[code] || 'üå§Ô∏è';
        }

        function animate() {
            requestAnimationFrame(animate);
            if (!isDragging) { earth.rotation.y += 0.001; }
            issModel.rotation.y += 0.01;
            renderer.render(scene, camera);
        }

        document.getElementById('toggleCompact').addEventListener('click', () => { compactMode = !compactMode; applyLayout(); });
        document.getElementById('toggleHide').addEventListener('click', () => { hidePanel = !hidePanel; applyLayout(); });
        applyLayout();
        function openExclusive(openId) {
            const ids = ['accPosContent','accCrewContent','accWeatherContent'];
            ids.forEach(id => { const el = document.getElementById(id); if (!el) return; el.style.display = (id === openId && el.style.display !== 'block') ? 'block' : 'none'; });
            const pc = document.getElementById('accPosControls'); if (pc) pc.style.display = openId === 'accPosContent' ? 'block' : 'none';
        }
        document.getElementById('accPos').addEventListener('click', () => openExclusive('accPosContent'));
        document.getElementById('accCrew').addEventListener('click', () => openExclusive('accCrewContent'));
        document.getElementById('accWeather').addEventListener('click', () => openExclusive('accWeatherContent'));
        const ul = document.getElementById('accUserLocation'); if (ul) ul.textContent = `${userLat.toFixed(2)}¬∞, ${userLon.toFixed(2)}¬∞`;
        // mirror pass times initially
        const pt = document.getElementById('passTimes'); const apt = document.getElementById('accPassTimes'); if (pt && apt) apt.innerHTML = pt.innerHTML;
        const btnISS = () => document.getElementById('btnToggleISS');
        const btnOrbit = () => document.getElementById('btnToggleOrbit');
        document.addEventListener('click', (e) => {
            if (e.target && e.target.id === 'btnToggleISS') {
                const visible = !(issSprite.visible || issMarker.visible); issSprite.visible = visible; issMarker.visible = visible; btnISS().textContent = visible ? 'Mekiƒüi Gizle' : 'Mekiƒüi G√∂ster';
            } else if (e.target && e.target.id === 'btnToggleOrbit') {
                showOrbit = !showOrbit; orbitRing.visible = showOrbit; btnOrbit().textContent = showOrbit ? 'Halkayƒ± Gizle' : 'Halkayƒ± G√∂ster';
            }
        });
        function updateOrbitRing() {
            if (issPositions.length < 2) return;
            const p = issPositions[issPositions.length - 1].clone().normalize().multiplyScalar(RING_RADIUS);
            const q = issPositions[issPositions.length - 2].clone().normalize().multiplyScalar(RING_RADIUS);
            const r = RING_RADIUS;
            const normal = new THREE.Vector3().crossVectors(p, q).normalize();
            if (normal.length() < 1e-6) return;
            const u = p.clone().normalize();
            const v = new THREE.Vector3().crossVectors(normal, u).normalize();
            const segments = 256;
            const ringPoints = [];
            for (let i = 0; i < segments; i++) {
                const t = (i / segments) * Math.PI * 2;
                const point = new THREE.Vector3()
                    .addVectors(u.clone().multiplyScalar(Math.cos(t) * r), v.clone().multiplyScalar(Math.sin(t) * r));
                ringPoints.push(point);
            }
            const geom = new THREE.BufferGeometry().setFromPoints(ringPoints);
            if (orbitRing.geometry) orbitRing.geometry.dispose();
            orbitRing.geometry = geom;
        }
        init();
    </script>
</body>
</html>
